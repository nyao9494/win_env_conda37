{"version":3,"file":"BranchMenu.js","sourceRoot":"./@jupyterlab/git/src/","sources":["components/BranchMenu.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Dialog, showDialog, showErrorMessage } from '@jupyterlab/apputils';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ClearIcon from '@material-ui/icons/Clear';\nimport * as React from 'react';\nimport { FixedSizeList, ListChildComponentProps } from 'react-window';\nimport { classes } from 'typestyle';\nimport { Logger } from '../logger';\nimport {\n  activeListItemClass,\n  filterClass,\n  filterClearClass,\n  filterInputClass,\n  filterWrapperClass,\n  listItemClass,\n  listItemIconClass,\n  newBranchButtonClass,\n  wrapperClass\n} from '../style/BranchMenu';\nimport { branchIcon } from '../style/icons';\nimport { Git, IGitExtension, Level } from '../tokens';\nimport { NewBranchDialog } from './NewBranchDialog';\n\nconst CHANGES_ERR_MSG =\n  'The current branch contains files with uncommitted changes. Please commit or discard these changes before switching to or creating another branch.';\nconst ITEM_HEIGHT = 24.8; // HTML element height for a single branch\nconst MIN_HEIGHT = 150; // Minimal HTML element height for the branches list\nconst MAX_HEIGHT = 400; // Maximal HTML element height for the branches list\n\n/**\n * Callback invoked upon encountering an error when switching branches.\n *\n * @private\n * @param error - error\n * @param logger - the logger\n */\nfunction onBranchError(error: any, logger: Logger): void {\n  if (error.message.includes('following files would be overwritten')) {\n    // Empty log message to hide the executing alert\n    logger.log({\n      message: '',\n      level: Level.INFO\n    });\n    showDialog({\n      title: 'Unable to switch branch',\n      body: (\n        <React.Fragment>\n          <p>\n            Your changes to the following files would be overwritten by\n            switching:\n          </p>\n          <List>\n            {error.message\n              .split('\\n')\n              .slice(1, -3)\n              .map(renderFileName)}\n          </List>\n          <span>\n            Please commit, stash, or discard your changes before you switch\n            branches.\n          </span>\n        </React.Fragment>\n      ),\n      buttons: [Dialog.okButton({ label: 'Dismiss' })]\n    });\n  } else {\n    logger.log({\n      level: Level.ERROR,\n      message: 'Failed to switch branch.',\n      error\n    });\n  }\n}\n\n/**\n * Renders a file name.\n *\n * @private\n * @param filename - file name\n * @returns React element\n */\nfunction renderFileName(filename: string): React.ReactElement {\n  return <ListItem key={filename}>{filename}</ListItem>;\n}\n\n/**\n * Interface describing component properties.\n */\nexport interface IBranchMenuProps {\n  /**\n   * Current branch name.\n   */\n  currentBranch: string;\n\n  /**\n   * Current list of branches.\n   */\n  branches: Git.IBranch[];\n\n  /**\n   * Boolean indicating whether branching is disabled.\n   */\n  branching: boolean;\n\n  /**\n   * Extension logger\n   */\n  logger: Logger;\n\n  /**\n   * Git extension data model.\n   */\n  model: IGitExtension;\n}\n\n/**\n * Interface describing component state.\n */\nexport interface IBranchMenuState {\n  /**\n   * Boolean indicating whether to show a dialog to create a new branch.\n   */\n  branchDialog: boolean;\n\n  /**\n   * Menu filter.\n   */\n  filter: string;\n}\n\n/**\n * React component for rendering a branch menu.\n */\nexport class BranchMenu extends React.Component<\n  IBranchMenuProps,\n  IBranchMenuState\n> {\n  /**\n   * Returns a React component for rendering a branch menu.\n   *\n   * @param props - component properties\n   * @returns React component\n   */\n  constructor(props: IBranchMenuProps) {\n    super(props);\n\n    this.state = {\n      filter: '',\n      branchDialog: false\n    };\n  }\n\n  /**\n   * Renders the component.\n   *\n   * @returns React element\n   */\n  render(): React.ReactElement {\n    return (\n      <div className={wrapperClass}>\n        {this._renderFilter()}\n        {this._renderBranchList()}\n        {this._renderNewBranchDialog()}\n      </div>\n    );\n  }\n\n  /**\n   * Renders a branch input filter.\n   *\n   * @returns React element\n   */\n  private _renderFilter(): React.ReactElement {\n    return (\n      <div className={filterWrapperClass}>\n        <div className={filterClass}>\n          <input\n            className={filterInputClass}\n            type=\"text\"\n            onChange={this._onFilterChange}\n            value={this.state.filter}\n            placeholder=\"Filter\"\n            title=\"Filter branch menu\"\n          />\n          {this.state.filter ? (\n            <button className={filterClearClass}>\n              <ClearIcon\n                titleAccess=\"Clear the current filter\"\n                fontSize=\"small\"\n                onClick={this._resetFilter}\n              />\n            </button>\n          ) : null}\n        </div>\n        <input\n          className={newBranchButtonClass}\n          type=\"button\"\n          title=\"Create a new branch\"\n          value=\"New Branch\"\n          onClick={this._onNewBranchClick}\n        />\n      </div>\n    );\n  }\n\n  /**\n   * Renders a\n   *\n   * @returns React element\n   */\n  private _renderBranchList(): React.ReactElement {\n    // Perform a \"simple\" filter... (TODO: consider implementing fuzzy filtering)\n    const filter = this.state.filter;\n    const branches = this.props.branches.filter(\n      branch => !filter || branch.name.includes(filter)\n    );\n    return (\n      <FixedSizeList\n        height={Math.min(\n          Math.max(MIN_HEIGHT, branches.length * ITEM_HEIGHT),\n          MAX_HEIGHT\n        )}\n        itemCount={branches.length}\n        itemData={branches}\n        itemKey={(index, data) => data[index].name}\n        itemSize={ITEM_HEIGHT}\n        style={{ overflowX: 'hidden', paddingTop: 0, paddingBottom: 0 }}\n        width={'auto'}\n      >\n        {this._renderItem}\n      </FixedSizeList>\n    );\n  }\n\n  /**\n   * Renders a menu item.\n   *\n   * @param props Row properties\n   * @returns React element\n   */\n  private _renderItem = (props: ListChildComponentProps): JSX.Element => {\n    const { data, index, style } = props;\n    const branch = data[index] as Git.IBranch;\n    const isActive = branch.name === this.props.currentBranch;\n    return (\n      <ListItem\n        button\n        title={`Switch to branch: ${branch.name}`}\n        className={classes(\n          listItemClass,\n          isActive ? activeListItemClass : null\n        )}\n        onClick={this._onBranchClickFactory(branch.name)}\n        style={style}\n      >\n        <branchIcon.react className={listItemIconClass} tag=\"span\" />\n        {branch.name}\n      </ListItem>\n    );\n  };\n\n  /**\n   * Renders a dialog for creating a new branch.\n   *\n   * @returns React element\n   */\n  private _renderNewBranchDialog(): React.ReactElement {\n    return (\n      <NewBranchDialog\n        currentBranch={this.props.currentBranch}\n        branches={this.props.branches}\n        logger={this.props.logger}\n        open={this.state.branchDialog}\n        model={this.props.model}\n        onClose={this._onNewBranchDialogClose}\n      />\n    );\n  }\n\n  /**\n   * Callback invoked upon a change to the menu filter.\n   *\n   * @param event - event object\n   */\n  private _onFilterChange = (event: any): void => {\n    this.setState({\n      filter: event.target.value\n    });\n  };\n\n  /**\n   * Callback invoked to reset the menu filter.\n   */\n  private _resetFilter = (): void => {\n    this.setState({\n      filter: ''\n    });\n  };\n\n  /**\n   * Callback invoked upon clicking a button to create a new branch.\n   *\n   * @param event - event object\n   */\n  private _onNewBranchClick = (): void => {\n    if (!this.props.branching) {\n      showErrorMessage('Creating a new branch is disabled', CHANGES_ERR_MSG);\n      return;\n    }\n    this.setState({\n      branchDialog: true\n    });\n  };\n\n  /**\n   * Callback invoked upon closing a dialog to create a new branch.\n   */\n  private _onNewBranchDialogClose = (): void => {\n    this.setState({\n      branchDialog: false\n    });\n  };\n\n  /**\n   * Returns a callback which is invoked upon clicking a branch name.\n   *\n   * @param branch - branch name\n   * @returns callback\n   */\n  private _onBranchClickFactory(branch: string) {\n    const self = this;\n    return onClick;\n\n    /**\n     * Callback invoked upon clicking a branch name.\n     *\n     * @private\n     * @param event - event object\n     * @returns promise which resolves upon attempting to switch branches\n     */\n    async function onClick(): Promise<void> {\n      if (!self.props.branching) {\n        showErrorMessage('Switching branches is disabled', CHANGES_ERR_MSG);\n        return;\n      }\n      const opts = {\n        branchname: branch\n      };\n\n      self.props.logger.log({\n        level: Level.RUNNING,\n        message: 'Switching branch...'\n      });\n\n      try {\n        await self.props.model.checkout(opts);\n      } catch (err) {\n        return onBranchError(err, self.props.logger);\n      }\n\n      self.props.logger.log({\n        level: Level.SUCCESS,\n        message: 'Switched branch.'\n      });\n    }\n  }\n}\n"]}