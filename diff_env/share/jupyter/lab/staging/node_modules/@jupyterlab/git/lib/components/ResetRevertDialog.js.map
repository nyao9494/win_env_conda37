{"version":3,"file":"ResetRevertDialog.js","sourceRoot":"./@jupyterlab/git/src/","sources":["components/ResetRevertDialog.tsx"],"names":[],"mappings":"AAAA,OAAO,MAAM,MAAM,0BAA0B,CAAC;AAC9C,OAAO,aAAa,MAAM,iCAAiC,CAAC;AAC5D,OAAO,SAAS,MAAM,0BAA0B,CAAC;AACjD,OAAO,KAAK,KAAK,MAAM,OAAO,CAAC;AAC/B,OAAO,gBAAgB,MAAM,yBAAyB,CAAC;AACvD,OAAO,EAAE,OAAO,EAAE,MAAM,WAAW,CAAC;AAEpC,OAAO,EACL,mBAAmB,EACnB,WAAW,EACX,iBAAiB,EACjB,gBAAgB,EAChB,sBAAsB,EACtB,eAAe,EACf,kBAAkB,EAClB,mBAAmB,EACnB,sBAAsB,EACtB,iBAAiB,EACjB,UAAU,EACV,iBAAiB,EAClB,MAAM,4BAA4B,CAAC;AACpC,OAAO,EAAsB,KAAK,EAAE,MAAM,WAAW,CAAC;AAyDtD;;GAEG;AACH,MAAM,OAAO,iBAAkB,SAAQ,KAAK,CAAC,SAG5C;IACC;;;;;OAKG;IACH,YAAY,KAA8B;QACxC,KAAK,CAAC,KAAK,CAAC,CAAC;QAsFf;;;;WAIG;QACK,qBAAgB,GAAG,CAAC,KAAU,EAAQ,EAAE;YAC9C,IAAI,CAAC,QAAQ,CAAC;gBACZ,OAAO,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK;aAC5B,CAAC,CAAC;QACL,CAAC,CAAC;QAEF;;;;WAIG;QACK,yBAAoB,GAAG,CAAC,KAAU,EAAQ,EAAE;YAClD,IAAI,CAAC,QAAQ,CAAC;gBACZ,WAAW,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK;aAChC,CAAC,CAAC;QACL,CAAC,CAAC;QAEF;;;;WAIG;QACK,aAAQ,GAAG,CAAC,KAAU,EAAQ,EAAE;YACtC,KAAK,CAAC,eAAe,EAAE,CAAC;QAC1B,CAAC,CAAC;QAEF;;;;WAIG;QACK,aAAQ,GAAG,CAAC,KAAU,EAAQ,EAAE;YACtC,KAAK,CAAC,eAAe,EAAE,CAAC;YACxB,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC;YACrB,IAAI,CAAC,MAAM,EAAE,CAAC;QAChB,CAAC,CAAC;QAsDF;;;;WAIG;QACK,cAAS,GAAG,KAAK,IAAmB,EAAE;YAC5C,IAAI,CAAC,QAAQ,CAAC;gBACZ,QAAQ,EAAE,IAAI;aACf,CAAC,CAAC;YAEH,IAAI,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,OAAO,EAAE;gBACjC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;aAC7C;iBAAM;gBACL,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC;aAC9C;YACD,IAAI,CAAC,MAAM,EAAE,CAAC;YACd,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC;QACvB,CAAC,CAAC;QApMA,IAAI,CAAC,KAAK,GAAG;YACX,OAAO,EAAE,EAAE;YACX,WAAW,EAAE,EAAE;YACf,QAAQ,EAAE,KAAK;SAChB,CAAC;IACJ,CAAC;IAED;;;;OAIG;IACH,MAAM;QACJ,MAAM,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACzD,MAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,QAAQ,CAAC;QAChD,OAAO,CACL,oBAAC,MAAM,IACL,OAAO,EAAE;gBACP,KAAK,EAAE,sBAAsB;aAC9B,EACD,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,EACrB,OAAO,EAAE,IAAI,CAAC,QAAQ,EACtB,OAAO,EAAE,IAAI,CAAC,QAAQ;YAEtB,6BAAK,SAAS,EAAE,iBAAiB;gBAC/B,2BAAG,SAAS,EAAE,UAAU,IACrB,QAAQ,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,eAAe,CAC5C;gBACJ,gCAAQ,SAAS,EAAE,gBAAgB;oBACjC,oBAAC,SAAS,IACR,WAAW,EAAC,mBAAmB,EAC/B,QAAQ,EAAC,OAAO,EAChB,OAAO,EAAE,IAAI,CAAC,QAAQ,GACtB,CACK,CACL;YACN,6BAAK,SAAS,EAAE,mBAAmB;gBACjC,+BACG,QAAQ;oBACP,CAAC,CAAC,8FAA8F;oBAChG,CAAC,CAAC,4BAA4B,WAAW,mDAAmD,CAC5F;gBACH,QAAQ,CAAC,CAAC,CAAC,CACV,6BAAK,SAAS,EAAE,eAAe;oBAC7B,+BACE,SAAS,EAAE,kBAAkB,EAC7B,IAAI,EAAC,MAAM,EACX,WAAW,EAAE,IAAI,CAAC,eAAe,EAAE,EACnC,KAAK,EAAC,oFAAoF,EAC1F,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO,EACzB,QAAQ,EAAE,IAAI,CAAC,gBAAgB,GAC/B;oBACF,oBAAC,gBAAgB,IACf,SAAS,EAAE,sBAAsB,EACjC,OAAO,EAAE,CAAC,EACV,WAAW,EAAE,IAAI,CAAC,mBAAmB,EAAE,EACvC,KAAK,EAAC,oCAAoC,EAC1C,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,EAC7B,QAAQ,EAAE,IAAI,CAAC,oBAAoB,GACnC,CACE,CACP,CAAC,CAAC,CAAC,IAAI,CACJ;YACN,oBAAC,aAAa,IAAC,SAAS,EAAE,mBAAmB;gBAC3C,+BACE,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAC7B,SAAS,EAAE,OAAO,CAAC,WAAW,EAAE,iBAAiB,CAAC,EAClD,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,gBAAgB,EACtB,KAAK,EAAC,QAAQ,EACd,OAAO,EAAE,IAAI,CAAC,QAAQ,GACtB;gBACF,+BACE,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,EAC7B,SAAS,EAAE,OAAO,CAAC,WAAW,EAAE,iBAAiB,CAAC,EAClD,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,gBAAgB,EACtB,KAAK,EAAC,QAAQ,EACd,OAAO,EAAE,IAAI,CAAC,SAAS,GACvB,CACY,CACT,CACV,CAAC;IACJ,CAAC;IA4CD;;;;OAIG;IACK,KAAK,CAAC,YAAY,CAAC,IAAY;QACrC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;YACpB,KAAK,EAAE,KAAK,CAAC,OAAO;YACpB,OAAO,EAAE,uBAAuB;SACjC,CAAC,CAAC;QACH,IAAI;YACF,MAAM,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YAC3C,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;gBACpB,KAAK,EAAE,KAAK,CAAC,OAAO;gBACpB,OAAO,EAAE,iCAAiC;aAC3C,CAAC,CAAC;SACJ;QAAC,OAAO,KAAK,EAAE;YACd,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;gBACpB,KAAK,EAAE,KAAK,CAAC,KAAK;gBAClB,OAAO,EAAE,4BAA4B;gBACrC,KAAK,EAAE,IAAI,KAAK,CACd,mCAAmC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,EAAE,CAChE;aACF,CAAC,CAAC;SACJ;IACH,CAAC;IAED;;;;OAIG;IACK,KAAK,CAAC,aAAa,CAAC,IAAY;QACtC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;YACpB,KAAK,EAAE,KAAK,CAAC,OAAO;YACpB,OAAO,EAAE,sBAAsB;SAChC,CAAC,CAAC;QACH,IAAI;YACF,MAAM,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,IAAI,CAAC,CAAC;YACjE,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;gBACpB,KAAK,EAAE,KAAK,CAAC,OAAO;gBACpB,OAAO,EAAE,gCAAgC;aAC1C,CAAC,CAAC;SACJ;QAAC,OAAO,KAAK,EAAE;YACd,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,GAAG,CAAC;gBACpB,KAAK,EAAE,KAAK,CAAC,KAAK;gBAClB,OAAO,EAAE,2BAA2B;gBACpC,KAAK,EAAE,IAAI,KAAK,CAAC,oBAAoB,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,KAAK,EAAE,CAAC;aACnE,CAAC,CAAC;SACJ;IACH,CAAC;IAqBD;;;;OAIG;IACK,eAAe;QACrB,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5D,OAAO,WAAW,OAAO,GAAG,CAAC;IAC/B,CAAC;IAED;;;;OAIG;IACK,mBAAmB;QACzB,OAAO,uBAAuB,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,MAAM,EAAE,CAAC;IAC3D,CAAC;IAED;;;;OAIG;IACK,cAAc;QACpB,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,IAAI,IAAI,CAAC,eAAe,EAAE,CAAC;QAC7D,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,IAAI,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAClE,OAAO,OAAO,GAAG,MAAM,GAAG,IAAI,GAAG,IAAI,CAAC;IACxC,CAAC;IAED;;OAEG;IACK,MAAM;QACZ,IAAI,CAAC,QAAQ,CAAC;YACZ,OAAO,EAAE,EAAE;YACX,WAAW,EAAE,EAAE;YACf,QAAQ,EAAE,KAAK;SAChB,CAAC,CAAC;IACL,CAAC;CACF","sourcesContent":["import Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport ClearIcon from '@material-ui/icons/Clear';\nimport * as React from 'react';\nimport TextareaAutosize from 'react-textarea-autosize';\nimport { classes } from 'typestyle';\nimport { Logger } from '../logger';\nimport {\n  actionsWrapperClass,\n  buttonClass,\n  cancelButtonClass,\n  closeButtonClass,\n  commitDescriptionClass,\n  commitFormClass,\n  commitSummaryClass,\n  contentWrapperClass,\n  resetRevertDialogClass,\n  submitButtonClass,\n  titleClass,\n  titleWrapperClass\n} from '../style/ResetRevertDialog';\nimport { Git, IGitExtension, Level } from '../tokens';\n\n/**\n * Interface describing component properties.\n */\nexport interface IResetRevertDialogProps {\n  /**\n   * Type of action to perform.\n   */\n  action: 'reset' | 'revert';\n\n  /**\n   * Commit data for a single commit.\n   */\n  commit: Git.ISingleCommitInfo;\n\n  /**\n   * Extension data model.\n   */\n  model: IGitExtension;\n\n  /**\n   * Extension logger\n   */\n  logger: Logger;\n\n  /**\n   * Boolean indicating whether to show the dialog.\n   */\n  open: boolean;\n\n  /**\n   * Callback invoked upon closing the dialog.\n   */\n  onClose: () => void;\n}\n\n/**\n * Interface describing component state.\n */\nexport interface IResetRevertDialogState {\n  /**\n   * Commit message summary.\n   */\n  summary: string;\n\n  /**\n   * Commit message description.\n   */\n  description: string;\n\n  /**\n   * Boolean indicating whether component buttons should be disabled.\n   */\n  disabled: boolean;\n}\n\n/**\n * React component for rendering a dialog for resetting or reverting a single commit.\n */\nexport class ResetRevertDialog extends React.Component<\n  IResetRevertDialogProps,\n  IResetRevertDialogState\n> {\n  /**\n   * Returns a React component for resetting or reverting a single commit.\n   *\n   * @param props - component properties\n   * @returns React component\n   */\n  constructor(props: IResetRevertDialogProps) {\n    super(props);\n    this.state = {\n      summary: '',\n      description: '',\n      disabled: false\n    };\n  }\n\n  /**\n   * Renders a dialog.\n   *\n   * @returns React element\n   */\n  render(): React.ReactElement {\n    const shortCommit = this.props.commit.commit.slice(0, 7);\n    const isRevert = this.props.action === 'revert';\n    return (\n      <Dialog\n        classes={{\n          paper: resetRevertDialogClass\n        }}\n        open={this.props.open}\n        onClick={this._onClick}\n        onClose={this._onClose}\n      >\n        <div className={titleWrapperClass}>\n          <p className={titleClass}>\n            {isRevert ? 'Revert Changes' : 'Reset Changes'}\n          </p>\n          <button className={closeButtonClass}>\n            <ClearIcon\n              titleAccess=\"Close this dialog\"\n              fontSize=\"small\"\n              onClick={this._onClose}\n            />\n          </button>\n        </div>\n        <div className={contentWrapperClass}>\n          <p>\n            {isRevert\n              ? \"These changes will be reverted. Only commit if you're sure you're okay losing these changes.\"\n              : `All changes after commit ${shortCommit} will be gone forever (hard reset). Are you sure?`}\n          </p>\n          {isRevert ? (\n            <div className={commitFormClass}>\n              <input\n                className={commitSummaryClass}\n                type=\"text\"\n                placeholder={this._defaultSummary()}\n                title=\"Enter a commit message summary (a single line, preferably less than 50 characters)\"\n                value={this.state.summary}\n                onChange={this._onSummaryChange}\n              />\n              <TextareaAutosize\n                className={commitDescriptionClass}\n                minRows={5}\n                placeholder={this._defaultDescription()}\n                title=\"Enter a commit message description\"\n                value={this.state.description}\n                onChange={this._onDescriptionChange}\n              />\n            </div>\n          ) : null}\n        </div>\n        <DialogActions className={actionsWrapperClass}>\n          <input\n            disabled={this.state.disabled}\n            className={classes(buttonClass, cancelButtonClass)}\n            type=\"button\"\n            title=\"Cancel changes\"\n            value=\"Cancel\"\n            onClick={this._onClose}\n          />\n          <input\n            disabled={this.state.disabled}\n            className={classes(buttonClass, submitButtonClass)}\n            type=\"button\"\n            title=\"Submit changes\"\n            value=\"Submit\"\n            onClick={this._onSubmit}\n          />\n        </DialogActions>\n      </Dialog>\n    );\n  }\n\n  /**\n   * Callback invoked upon updating a commit message summary.\n   *\n   * @param event - event object\n   */\n  private _onSummaryChange = (event: any): void => {\n    this.setState({\n      summary: event.target.value\n    });\n  };\n\n  /**\n   * Callback invoked upon updating a commit message description.\n   *\n   * @param event - event object\n   */\n  private _onDescriptionChange = (event: any): void => {\n    this.setState({\n      description: event.target.value\n    });\n  };\n\n  /**\n   * Callback invoked upon clicking on a dialog.\n   *\n   * @param event - event object\n   */\n  private _onClick = (event: any): void => {\n    event.stopPropagation();\n  };\n\n  /**\n   * Callback invoked upon closing the dialog.\n   *\n   * @param event - event object\n   */\n  private _onClose = (event: any): void => {\n    event.stopPropagation();\n    this.props.onClose();\n    this._reset();\n  };\n\n  /**\n   * Reset the current branch on the provided commit\n   *\n   * @param hash Git commit hash\n   */\n  private async _resetCommit(hash: string): Promise<void> {\n    this.props.logger.log({\n      level: Level.RUNNING,\n      message: 'Discarding changes...'\n    });\n    try {\n      await this.props.model.resetToCommit(hash);\n      this.props.logger.log({\n        level: Level.SUCCESS,\n        message: 'Successfully discarded changes.'\n      });\n    } catch (error) {\n      this.props.logger.log({\n        level: Level.ERROR,\n        message: 'Failed to discard changes.',\n        error: new Error(\n          `Failed to discard changes after ${hash.slice(0, 7)}: ${error}`\n        )\n      });\n    }\n  }\n\n  /**\n   * Revert the provided commit.\n   *\n   * @param hash Git commit hash\n   */\n  private async _revertCommit(hash: string): Promise<void> {\n    this.props.logger.log({\n      level: Level.RUNNING,\n      message: 'Reverting changes...'\n    });\n    try {\n      await this.props.model.revertCommit(this._commitMessage(), hash);\n      this.props.logger.log({\n        level: Level.SUCCESS,\n        message: 'Successfully reverted changes.'\n      });\n    } catch (error) {\n      this.props.logger.log({\n        level: Level.ERROR,\n        message: 'Failed to revert changes.',\n        error: new Error(`Failed to revert ${hash.slice(0, 7)}: ${error}`)\n      });\n    }\n  }\n\n  /**\n   * Callback invoked upon clicking a button to reset or revert a commit.\n   *\n   * @param event - event object\n   */\n  private _onSubmit = async (): Promise<void> => {\n    this.setState({\n      disabled: true\n    });\n\n    if (this.props.action === 'reset') {\n      this._resetCommit(this.props.commit.commit);\n    } else {\n      this._revertCommit(this.props.commit.commit);\n    }\n    this._reset();\n    this.props.onClose();\n  };\n\n  /**\n   * Returns a default commit summary for reverting a commit.\n   *\n   * @returns default commit summary\n   */\n  private _defaultSummary(): string {\n    const summary = this.props.commit.commit_msg.split('\\n')[0];\n    return `Revert \"${summary}\"`;\n  }\n\n  /**\n   * Returns a default commit description for reverting a commit.\n   *\n   * @returns default commit description\n   */\n  private _defaultDescription(): string {\n    return `This reverts commit ${this.props.commit.commit}`;\n  }\n\n  /**\n   * Returns a commit message for reverting a commit.\n   *\n   * @returns commit message\n   */\n  private _commitMessage(): string {\n    const summary = this.state.summary || this._defaultSummary();\n    const desc = this.state.description || this._defaultDescription();\n    return summary + '\\n\\n' + desc + '\\n';\n  }\n\n  /**\n   * Resets component state.\n   */\n  private _reset(): void {\n    this.setState({\n      summary: '',\n      description: '',\n      disabled: false\n    });\n  }\n}\n"]}