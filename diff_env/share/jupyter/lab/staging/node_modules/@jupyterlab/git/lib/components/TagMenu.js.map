{"version":3,"file":"TagMenu.js","sourceRoot":"./@jupyterlab/git/src/","sources":["components/TagMenu.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Dialog, showDialog, showErrorMessage } from '@jupyterlab/apputils';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ClearIcon from '@material-ui/icons/Clear';\nimport * as React from 'react';\nimport { FixedSizeList, ListChildComponentProps } from 'react-window';\nimport { Logger } from '../logger';\nimport {\n  filterClass,\n  filterClearClass,\n  filterInputClass,\n  filterWrapperClass,\n  listItemClass,\n  listItemIconClass,\n  wrapperClass\n} from '../style/BranchMenu';\nimport { tagIcon } from '../style/icons';\nimport { IGitExtension, Level } from '../tokens';\n\nconst CHANGES_ERR_MSG =\n  'The repository contains files with uncommitted changes. Please commit or discard these changes before switching to a tag.';\nconst ITEM_HEIGHT = 24.8; // HTML element height for a single branch\nconst MIN_HEIGHT = 150; // Minimal HTML element height for the tags list\nconst MAX_HEIGHT = 400; // Maximal HTML element height for the tags list\n\n/**\n * Callback invoked upon encountering an error when switching tags.\n *\n * @private\n * @param error - error\n * @param logger - the logger\n */\nfunction onTagError(error: any, logger: Logger): void {\n  if (error.message.includes('following files would be overwritten')) {\n    // Empty log message to hide the executing alert\n    logger.log({\n      message: '',\n      level: Level.INFO\n    });\n    showDialog({\n      title: 'Unable to checkout tag',\n      body: (\n        <React.Fragment>\n          <p>\n            Your changes to the following files would be overwritten by\n            switching:\n          </p>\n          <List>\n            {error.message\n              .split('\\n')\n              .slice(1, -3)\n              .map(renderFileName)}\n          </List>\n          <span>\n            Please commit, stash, or discard your changes before you checkout\n            tags.\n          </span>\n        </React.Fragment>\n      ),\n      buttons: [Dialog.okButton({ label: 'Dismiss' })]\n    });\n  } else {\n    logger.log({\n      level: Level.ERROR,\n      message: 'Failed to checkout tag.',\n      error\n    });\n  }\n}\n\n/**\n * Renders a file name.\n *\n * @private\n * @param filename - file name\n * @returns React element\n */\nfunction renderFileName(filename: string): React.ReactElement {\n  return <ListItem key={filename}>{filename}</ListItem>;\n}\n\n/**\n * Interface describing component properties.\n */\nexport interface ITagMenuProps {\n  /**\n   * Boolean indicating whether branching is disabled.\n   */\n  branching: boolean;\n\n  /**\n   * Extension logger\n   */\n  logger: Logger;\n\n  /**\n   * Git extension data model.\n   */\n  model: IGitExtension;\n}\n\n/**\n * Interface describing component state.\n */\nexport interface ITagMenuState {\n  /**\n   * Menu filter.\n   */\n  filter: string;\n\n  /**\n   * Current list of tags.\n   */\n  tags: string[];\n}\n\n/**\n * React component for rendering a branch menu.\n */\nexport class TagMenu extends React.Component<ITagMenuProps, ITagMenuState> {\n  /**\n   * Returns a React component for rendering a branch menu.\n   *\n   * @param props - component properties\n   * @returns React component\n   */\n  constructor(props: ITagMenuProps) {\n    super(props);\n\n    this.state = {\n      filter: '',\n      tags: []\n    };\n  }\n\n  componentDidMount() {\n    this.props.model\n      .tags()\n      .then(response => {\n        this.setState({\n          tags: response.tags\n        });\n      })\n      .catch(error => {\n        console.error(error);\n        this.setState({\n          tags: []\n        });\n        showErrorMessage('Fail to get the tags.', error);\n      });\n  }\n\n  /**\n   * Renders the component.\n   *\n   * @returns React element\n   */\n  render(): React.ReactElement {\n    return (\n      <div className={wrapperClass}>\n        {this._renderFilter()}\n        {this._renderTagList()}\n      </div>\n    );\n  }\n\n  /**\n   * Renders a branch input filter.\n   *\n   * @returns React element\n   */\n  private _renderFilter(): React.ReactElement {\n    return (\n      <div className={filterWrapperClass}>\n        <div className={filterClass}>\n          <input\n            className={filterInputClass}\n            type=\"text\"\n            onChange={this._onFilterChange}\n            value={this.state.filter}\n            placeholder=\"Filter\"\n            title=\"Filter branch menu\"\n          />\n          {this.state.filter ? (\n            <button className={filterClearClass}>\n              <ClearIcon\n                titleAccess=\"Clear the current filter\"\n                fontSize=\"small\"\n                onClick={this._resetFilter}\n              />\n            </button>\n          ) : null}\n        </div>\n      </div>\n    );\n  }\n\n  /**\n   * Renders a\n   *\n   * @returns React element\n   */\n  private _renderTagList(): React.ReactElement {\n    // Perform a \"simple\" filter... (TODO: consider implementing fuzzy filtering)\n    const filter = this.state.filter;\n    const tags = this.state.tags.filter(tag => !filter || tag.includes(filter));\n    return (\n      <FixedSizeList\n        height={Math.min(\n          Math.max(MIN_HEIGHT, tags.length * ITEM_HEIGHT),\n          MAX_HEIGHT\n        )}\n        itemCount={tags.length}\n        itemData={tags}\n        itemKey={(index, data) => data[index]}\n        itemSize={ITEM_HEIGHT}\n        style={{ overflowX: 'hidden', paddingTop: 0, paddingBottom: 0 }}\n        width={'auto'}\n      >\n        {this._renderItem}\n      </FixedSizeList>\n    );\n  }\n\n  /**\n   * Renders a menu item.\n   *\n   * @param props Row properties\n   * @returns React element\n   */\n  private _renderItem = (props: ListChildComponentProps): JSX.Element => {\n    const { data, index, style } = props;\n    const tag = data[index] as string;\n\n    return (\n      <ListItem\n        button\n        title={`Checkout to tag: ${tag}`}\n        className={listItemClass}\n        onClick={this._onTagClickFactory(tag)}\n        style={style}\n      >\n        <tagIcon.react className={listItemIconClass} tag=\"span\" />\n        {tag}\n      </ListItem>\n    );\n  };\n\n  /**\n   * Callback invoked upon a change to the menu filter.\n   *\n   * @param event - event object\n   */\n  private _onFilterChange = (event: any): void => {\n    this.setState({\n      filter: event.target.value\n    });\n  };\n\n  /**\n   * Callback invoked to reset the menu filter.\n   */\n  private _resetFilter = (): void => {\n    this.setState({\n      filter: ''\n    });\n  };\n\n  /**\n   * Returns a callback which is invoked upon clicking a tag.\n   *\n   * @param branch - tag\n   * @returns callback\n   */\n  private _onTagClickFactory(tag: string) {\n    const self = this;\n    return onClick;\n\n    /**\n     * Callback invoked upon clicking a tag.\n     *\n     * @private\n     * @param event - event object\n     * @returns promise which resolves upon attempting to switch tags\n     */\n    async function onClick(): Promise<void> {\n      if (!self.props.branching) {\n        showErrorMessage('Checkout tags is disabled', CHANGES_ERR_MSG);\n        return;\n      }\n\n      self.props.logger.log({\n        level: Level.RUNNING,\n        message: 'Checking tag out...'\n      });\n\n      try {\n        await self.props.model.checkoutTag(tag);\n      } catch (err) {\n        return onTagError(err, self.props.logger);\n      }\n\n      self.props.logger.log({\n        level: Level.SUCCESS,\n        message: 'Tag checkout.'\n      });\n    }\n  }\n}\n"]}